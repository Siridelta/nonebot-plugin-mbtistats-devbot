<!DOCTYPE html>
<html style="height: 100%">

<head>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body style="height: 100%; margin: 0">
    <div class="container">
        <h1>{{ title }}</h1>
        <div class="meta">
            {{ group_name }}
            <div class="sep"></div>
            {{ total_count }} 人
            <div class="sep"></div>
            <span id="timestamp"></span>
        </div>
        
        <!-- 图片及文字说明区域 -->
        <div class="image-description-section">
            <div class="image-container">
                <div id="top-personality-image"></div>
            </div>
            <div class="description-container">
                <div id="top-personality-text"></div>
            </div>
        </div>
        
        <!-- 类型统计部分 -->
        <div class="section">
            <div class="section-title">类型统计</div>
            <div class="top-charts">
                <div id="pie-chart-container"></div>
                <div id="bar-chart-container"></div>
            </div>
            <!-- 将16人的历史趋势移到4色人格历史趋势上方 -->
            <div id="trait-trend-chart-container"></div>
            <div id="trend-chart-container"></div>
            <div id="history-table-container"></div>
        </div>
        
        <!-- 特质统计部分 -->
        <div class="section">
            <div class="section-title">特质统计</div>
            <div class="trait-charts-container">
                <div class="trait-chart-item">
                    <div id="chart-ei" style="width:100%; height:100%"></div>
                </div>
                <div class="trait-chart-item">
                    <div id="chart-ns" style="width:100%; height:100%"></div>
                </div>
                <div class="trait-chart-item">
                    <div id="chart-tf" style="width:100%; height:100%"></div>
                </div>
                <div class="trait-chart-item">
                    <div id="chart-jp" style="width:100%; height:100%"></div>
                </div>
            </div>
            <div id="trait-history-table-container"></div>
        </div>
    </div>

    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // Jinja2 注入的数据
            // 原始数据形如: [{"name": "INTP", "value": 15}, ...]
            const typeRawData = {{ type_data | tojson }};
            const typeHistoryData = {{ type_history_data | tojson }};
            const traitRawData = {{ trait_data | tojson }};
            const traitHistoryData = {{ trait_history_data | tojson }};

            // 显示最多人数的人格类型
            displayTopPersonality(typeRawData);

            // 渲染主要图表
            renderCharts(typeRawData);

            // 绘制历史趋势图
            drawTypeHistoryChart(typeHistoryData);
            
            // 绘制特质趋势图
            drawTraitTrendChart(typeHistoryData);
            
            // 初始化所有特质图表
            initAllTraitCharts(traitRawData);
        });
    </script>
    <script src="scripts.js"></script>
</body>

</html>