2026-02-22 23:10:46 [SUCCESS] nonebot | 2026-02-22 23:10:46 [SUCCESS] nonebot | NoneBot is initializing...
2026-02-22 23:10:46 [INFO] nonebot | 2026-02-22 23:10:46 [INFO] nonebot | Current Env: onebotv11-wsRev
2026-02-22 23:10:46 [DEBUG] nonebot | 2026-02-22 23:10:46 [DEBUG] nonebot | Loaded Config: {'driver': '~fastapi+~httpx+~websockets', 'host': IPv4Address('127.0.0.1'), 'port': 8080, 'log_level': 'INFO', 'api_timeout': 30.0, 'superusers': set(), 'nickname': set(), 'command_start': {'/'}, 'command_sep': {'.'}, 'session_expire_timeout': datetime.timedelta(seconds=120), 'environment': 'onebotv11-wsRev', 'localstore_use_cwd': True, 'onebot_ws_urls': ['ws://127.0.0.1:3001'], 'mbtistats_auto_stats_hour': 0, 'mbtistats_auto_stats_minute': 0, 'analysis_reanalysis_time': 0, 'analysis_display_image': True, 'analysis_enable_search': True, 'analysis_use_on_message': False, 'analysis_trust_env': False, 'ai_enabled': True, 'ai_api_key': 'sk-8d96bd3e257c292b3928a67b9544790eb8e3f0778721dc6380fa3db452fa00c7', 'ai_base_url': 'https://www.hubagi.cn/api/v1', 'ai_model': 'ZP-glm-4.5-flash', 'ai_max_history': 10}
2026-02-22 23:10:46 [DEBUG] nonebot | 2026-02-22 23:10:46 [DEBUG] nonebot | Succeeded to load adapter "QQ"
2026-02-22 23:10:46 [DEBUG] nonebot | 2026-02-22 23:10:46 [DEBUG] nonebot | Succeeded to load adapter "Console"
2026-02-22 23:10:47 [SUCCESS] nonebot | 2026-02-22 23:10:47 [SUCCESS] nonebot | Succeeded to load plugin "nonebot_plugin_apscheduler"
2026-02-22 23:10:47 [DEBUG] nonebot_plugin_mbtistats | 2026-02-22 23:10:47 [DEBUG] nonebot_plugin_mbtistats | [Config] Bot 根目录: F:\devbot\nonebot-plugin-mbtistats-devbot
2026-02-22 23:10:47 [DEBUG] nonebot_plugin_mbtistats | 2026-02-22 23:10:47 [DEBUG] nonebot_plugin_mbtistats | [Config] 数据根目录: F:\devbot\nonebot-plugin-mbtistats-devbot\data\mbtistats
2026-02-22 23:10:47 [INFO] nonebot_plugin_mbtistats | 2026-02-22 23:10:47 [INFO] nonebot_plugin_mbtistats | [AutoStats] 模块加载完成 - DEBUG_MODE=False, RUN_ON_STARTUP=False, SCHEDULE=00:00
2026-02-22 23:10:48 [SUCCESS] nonebot | 2026-02-22 23:10:48 [SUCCESS] nonebot | Succeeded to load plugin "nonebot_plugin_mbtistats"
2026-02-22 23:10:48 [SUCCESS] nonebot | 2026-02-22 23:10:48 [SUCCESS] nonebot | Succeeded to load plugin "nonebot_plugin_questionmark"
2026-02-22 23:10:48 [SUCCESS] nonebot | 2026-02-22 23:10:48 [SUCCESS] nonebot | Succeeded to load plugin "nonebot_plugin_saa"
2026-02-22 23:10:48 [SUCCESS] nonebot | 2026-02-22 23:10:48 [SUCCESS] nonebot | Succeeded to load plugin "nonebot_plugin_analysis_bilibili"
2026-02-22 23:10:48 [SUCCESS] nonebot | 2026-02-22 23:10:48 [SUCCESS] nonebot | Succeeded to load plugin "single_session" from "nonebot.plugins.single_session"
2026-02-22 23:10:48 [INFO] __main__ | 2026-02-22 23:10:48 [INFO] __main__ | Loading plugins from plugins directory...
2026-02-22 23:10:48 [SUCCESS] nonebot | 2026-02-22 23:10:48 [SUCCESS] nonebot | Succeeded to load plugin "timer_plugin" from "plugins.timer_plugin"
2026-02-22 23:10:48 [SUCCESS] nonebot | 2026-02-22 23:10:48 [SUCCESS] nonebot | Succeeded to load plugin "eval_plugin" from "plugins.eval_plugin"
2026-02-22 23:10:50 [SUCCESS] nonebot | 2026-02-22 23:10:50 [SUCCESS] nonebot | Succeeded to load plugin "ai_chat_plugin" from "plugins.ai_chat_plugin"
2026-02-22 23:10:50 [SUCCESS] nonebot | 2026-02-22 23:10:50 [SUCCESS] nonebot | Succeeded to load plugin "recall_plugin" from "plugins.recall_plugin"
2026-02-22 23:10:50 [INFO] __main__ | 2026-02-22 23:10:50 [INFO] __main__ | Plugins loaded!
2026-02-22 23:10:50 [SUCCESS] nonebot | 2026-02-22 23:10:50 [SUCCESS] nonebot | Running NoneBot...
2026-02-22 23:10:50 [SUCCESS] nonebot | 2026-02-22 23:10:50 [SUCCESS] nonebot | Loaded adapters: QQ, Console
2026-02-22 23:10:50 [INFO] uvicorn | 2026-02-22 23:10:50 [INFO] uvicorn | Started server process [20552]
2026-02-22 23:10:50 [INFO] uvicorn | 2026-02-22 23:10:50 [INFO] uvicorn | Waiting for application startup.
2026-02-22 23:10:50 [INFO] nonebot_plugin_apscheduler | 2026-02-22 23:10:50 [INFO] nonebot_plugin_apscheduler | Scheduler Started
2026-02-22 23:10:50 [INFO] nonebot_plugin_mbtistats | 2026-02-22 23:10:50 [INFO] nonebot_plugin_mbtistats | 正在启动 Playwright 浏览器内核...
2026-02-22 23:10:50 [SUCCESS] nonebot | 2026-02-22 23:10:50 [SUCCESS] nonebot | Console mounted.
2026-02-22 23:10:50 [DEBUG] nonebot_plugin_mbtistats | 2026-02-22 23:10:50 [DEBUG] nonebot_plugin_mbtistats | [AutoStats] 启动时执行已禁用（设置 auto_stats_run_on_startup=true 启用）
2026-02-22 23:10:52 [INFO] nonebot_plugin_mbtistats | 2026-02-22 23:10:52 [INFO] nonebot_plugin_mbtistats | Playwright 浏览器内核及上下文启动成功
2026-02-22 23:10:52 [INFO] ai_chat_plugin | 2026-02-22 23:10:52 [INFO] ai_chat_plugin | 开始加载 AI 配置...
2026-02-22 23:10:52 [INFO] ai_chat_plugin | 2026-02-22 23:10:52 [INFO] ai_chat_plugin | AI_API_KEY: sk-8d96bd3e257c...
2026-02-22 23:10:52 [INFO] ai_chat_plugin | 2026-02-22 23:10:52 [INFO] ai_chat_plugin | AI_BASE_URL: https://www.hubagi.cn/api/v1
2026-02-22 23:10:52 [INFO] ai_chat_plugin | 2026-02-22 23:10:52 [INFO] ai_chat_plugin | AI_MODEL: ZP-glm-4.5-flash
2026-02-22 23:10:52 [INFO] ai_chat_plugin | 2026-02-22 23:10:52 [INFO] ai_chat_plugin | AI_ENABLED: True
2026-02-22 23:10:52 [INFO] ai_chat_plugin | 2026-02-22 23:10:52 [INFO] ai_chat_plugin | OPENAI_AVAILABLE: True
2026-02-22 23:10:52 [INFO] ai_chat_plugin | 2026-02-22 23:10:52 [INFO] ai_chat_plugin | AI对话功能已启用，模型: ZP-glm-4.5-flash
2026-02-22 23:10:52 [DEBUG] nonebot | 2026-02-22 23:10:52 [DEBUG] nonebot | QQ | QQ run in sandbox mode: False
2026-02-22 23:10:52 [DEBUG] nonebot | 2026-02-22 23:10:52 [DEBUG] nonebot | QQ | QQ api base url: https://api.sgroup.qq.com/
2026-02-22 23:10:52 [INFO] uvicorn | 2026-02-22 23:10:52 [INFO] uvicorn | Application startup complete.
2026-02-22 23:10:52 [INFO] uvicorn | 2026-02-22 23:10:52 [INFO] uvicorn | Uvicorn running on http://127.0.0.1:8080 (Press CTRL+C to quit)
2026-02-22 23:10:58 [SUCCESS] nonebot | 2026-02-22 23:10:58 [SUCCESS] nonebot | Console robot | [message]: Message from User(user) @ 通用: 'hi'
2026-02-22 23:10:58 [DEBUG] nonebot | 2026-02-22 23:10:58 [DEBUG] nonebot | Running PreProcessors...
2026-02-22 23:10:58 [DEBUG] nonebot | 2026-02-22 23:10:58 [DEBUG] nonebot | Checking for matchers in priority 1...
2026-02-22 23:10:58 [DEBUG] nonebot | 2026-02-22 23:10:58 [DEBUG] nonebot | Checking for matchers in priority 5...
2026-02-22 23:10:58 [DEBUG] nonebot | 2026-02-22 23:10:58 [DEBUG] nonebot | Checking for matchers in priority 10...
2026-02-22 23:10:58 [INFO] nonebot | 2026-02-22 23:10:58 [INFO] nonebot | Event will be handled by Matcher(type='message', module=plugins.ai_chat_plugin, lineno=372)
2026-02-22 23:10:58 [DEBUG] nonebot | 2026-02-22 23:10:58 [DEBUG] nonebot | Running Matcher(type='message', module=plugins.ai_chat_plugin, lineno=372)
2026-02-22 23:10:58 [DEBUG] nonebot | 2026-02-22 23:10:58 [DEBUG] nonebot | Running handler Dependent(call=handle_clear_history)
2026-02-22 23:10:58 [INFO] nonebot | 2026-02-22 23:10:58 [INFO] nonebot | Matcher(type='message', module=plugins.ai_chat_plugin, lineno=372) running complete
2026-02-22 23:10:58 [DEBUG] nonebot | 2026-02-22 23:10:58 [DEBUG] nonebot | Checking for matchers in priority 11...
2026-02-22 23:10:58 [DEBUG] nonebot | 2026-02-22 23:10:58 [DEBUG] nonebot | Checking for matchers in priority 20...
2026-02-22 23:10:58 [INFO] nonebot | 2026-02-22 23:10:58 [INFO] nonebot | Event will be handled by Matcher(type='message', module=plugins.ai_chat_plugin, lineno=323)
2026-02-22 23:10:58 [DEBUG] nonebot | 2026-02-22 23:10:58 [DEBUG] nonebot | Running Matcher(type='message', module=plugins.ai_chat_plugin, lineno=323)
2026-02-22 23:10:58 [DEBUG] nonebot | 2026-02-22 23:10:58 [DEBUG] nonebot | Running handler Dependent(call=handle_ai_chat)
2026-02-22 23:10:58 [DEBUG] ai_chat_plugin | 2026-02-22 23:10:58 [DEBUG] ai_chat_plugin | 收到消息事件，AI_ENABLED=True
2026-02-22 23:10:58 [INFO] nonebot | 2026-02-22 23:10:58 [INFO] nonebot | Matcher(type='message', module=plugins.ai_chat_plugin, lineno=323) running complete
2026-02-22 23:10:59 [ERROR] nonebot | 2026-02-22 23:10:58 [ERROR] nonebot | Running Matcher(type='message', module=plugins.ai_chat_plugin, lineno=323) failed.
Traceback (most recent call last):

  File "F:\devbot\nonebot-plugin-mbtistats-devbot\bot.py", line 52, in <module>
    nonebot.run()
    │       └ <function run at 0x000002A27728D260>
    └ <module 'nonebot' from 'F:\\devbot\\nonebot-plugin-mbtistats-devbot\\.venv\\Lib\\site-packages\\nonebot\\__init__.py'>

  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\__init__.py", line 337, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {}
    │                 └ ()
    └ <function get_driver at 0x000002A2761F0EA0>
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\drivers\fastapi.py", line 187, in run
    uvicorn.run(
    │       └ <function run at 0x000002A27981E340>
    └ <module 'uvicorn' from 'F:\\devbot\\nonebot-plugin-mbtistats-devbot\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\uvicorn\main.py", line 593, in run
    server.run()
    │      └ <function Server.run at 0x000002A27981DBC0>
    └ <uvicorn.server.Server object at 0x000002A27AAFBCB0>
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio_run(self.serve(sockets=sockets), loop_factory=self.config.get_loop_factory())
           │           │    │             │                      │    │      └ <function Config.get_loop_factory at 0x000002A27981D440>
           │           │    │             │                      │    └ <uvicorn.config.Config object at 0x000002A279F1F4D0>
           │           │    │             │                      └ <uvicorn.server.Server object at 0x000002A27AAFBCB0>
           │           │    │             └ None
           │           │    └ <function Server.serve at 0x000002A27981DC60>
           │           └ <uvicorn.server.Server object at 0x000002A27AAFBCB0>
           └ <function run at 0x000002A275C16C00>
  File "C:\Users\minec\AppData\Roaming\uv\python\cpython-3.13.11-windows-x86_64-none\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002A27A5B91C0>
           │      └ <function Runner.run at 0x000002A275D09300>
           └ <asyncio.runners.Runner object at 0x000002A27AD18050>
  File "C:\Users\minec\AppData\Roaming\uv\python\cpython-3.13.11-windows-x86_64-none\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002A275D06E80>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000002A27AD18050>
  File "C:\Users\minec\AppData\Roaming\uv\python\cpython-3.13.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 712, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002A275D06DE0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\minec\AppData\Roaming\uv\python\cpython-3.13.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 683, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002A275D08C20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\minec\AppData\Roaming\uv\python\cpython-3.13.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 2050, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002A275C17BA0>
    └ <Handle Task.task_wakeup()>
  File "C:\Users\minec\AppData\Roaming\uv\python\cpython-3.13.11-windows-x86_64-none\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\utils.py", line 259, in run_coro_with_shield
    return await coro
                 └ <coroutine object check_and_run_matcher at 0x000002A27B058EE0>
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\message.py", line 508, in check_and_run_matcher
    await _run_matcher(
          └ <function _run_matcher at 0x000002A2773CE980>
> File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\message.py", line 460, in _run_matcher
    await matcher.run(bot, event, state, stack, dependency_cache)
          │       │   │    │      │      │      └ {<function matcher_mutex at 0x000002A27A5AF420>: <nonebot.internal.params.DependencyCache object at 0x000002A27B0EB0E0>, <fun...
          │       │   │    │      │      └ <contextlib.AsyncExitStack object at 0x000002A27ADA34D0>
          │       │   │    │      └ {'_prefix': {'command': None, 'raw_command': None, 'command_arg': None, 'command_start': None, 'command_whitespace': None}}
          │       │   │    └ PublicMessageEvent(time=datetime.datetime(2026, 2, 22, 23, 10, 58, 779903), self_id='robot', post_type='message', user=User(i...
          │       │   └ Bot(type='Console', self_id='robot')
          │       └ <function Matcher.run at 0x000002A2772C8E00>
          └ Matcher(type='message', module=plugins.ai_chat_plugin, lineno=323)
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\internal\matcher\matcher.py", line 926, in run
    await self.simple_run(bot, event, state, stack, dependency_cache)
          │    │          │    │      │      │      └ {<function matcher_mutex at 0x000002A27A5AF420>: <nonebot.internal.params.DependencyCache object at 0x000002A27B0EB0E0>, <fun...
          │    │          │    │      │      └ <contextlib.AsyncExitStack object at 0x000002A27ADA34D0>
          │    │          │    │      └ {'_prefix': {'command': None, 'raw_command': None, 'command_arg': None, 'command_start': None, 'command_whitespace': None}}
          │    │          │    └ PublicMessageEvent(time=datetime.datetime(2026, 2, 22, 23, 10, 58, 779903), self_id='robot', post_type='message', user=User(i...
          │    │          └ Bot(type='Console', self_id='robot')
          │    └ <function Matcher.simple_run at 0x000002A2772C8D60>
          └ Matcher(type='message', module=plugins.ai_chat_plugin, lineno=323)
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\internal\matcher\matcher.py", line 863, in simple_run
    await handler(
          └ Dependent(call=handle_ai_chat)
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\dependencies\__init__.py", line 113, in __call__
    return await cast(Callable[..., Awaitable[R]], self.call)(**values)
                 │    │             │         │    │    │       └ {'bot': Bot(type='Console', self_id='robot'), 'event': PublicMessageEvent(time=datetime.datetime(2026, 2, 22, 23, 10, 58, 779...
                 │    │             │         │    │    └ <function handle_ai_chat at 0x000002A27AD10220>
                 │    │             │         │    └ Dependent(call=handle_ai_chat)
                 │    │             │         └ ~R
                 │    │             └ <class 'collections.abc.Awaitable'>
                 │    └ typing.Callable
                 └ <function cast at 0x000002A275CEA3E0>

  File "F:\devbot\nonebot-plugin-mbtistats-devbot\plugins\ai_chat_plugin.py", line 334, in handle_ai_chat
    adapter_name = event.adapter.name
                   └ PublicMessageEvent(time=datetime.datetime(2026, 2, 22, 23, 10, 58, 779903), self_id='robot', post_type='message', user=User(i...

  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\pydantic\main.py", line 1026, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
                                 │                                          └ 'adapter'
                                 └ PublicMessageEvent(time=datetime.datetime(2026, 2, 22, 23, 10, 58, 779903), self_id='robot', post_type='message', user=User(i...

AttributeError: 'PublicMessageEvent' object has no attribute 'adapter'


2026-02-22 23:10:59 [DEBUG] nonebot | 2026-02-22 23:10:59 [DEBUG] nonebot | Checking for matchers completed
2026-02-22 23:11:20 [SUCCESS] nonebot | 2026-02-22 23:11:20 [SUCCESS] nonebot | Console robot | [message]: Message from User(user): '你好'
2026-02-22 23:11:20 [DEBUG] nonebot | 2026-02-22 23:11:20 [DEBUG] nonebot | Running PreProcessors...
2026-02-22 23:11:20 [DEBUG] nonebot | 2026-02-22 23:11:20 [DEBUG] nonebot | Checking for matchers in priority 1...
2026-02-22 23:11:20 [DEBUG] nonebot | 2026-02-22 23:11:20 [DEBUG] nonebot | Checking for matchers in priority 5...
2026-02-22 23:11:20 [DEBUG] nonebot | 2026-02-22 23:11:20 [DEBUG] nonebot | Checking for matchers in priority 10...
2026-02-22 23:11:20 [INFO] nonebot | 2026-02-22 23:11:20 [INFO] nonebot | Event will be handled by Matcher(type='message', module=plugins.ai_chat_plugin, lineno=372)
2026-02-22 23:11:20 [DEBUG] nonebot | 2026-02-22 23:11:20 [DEBUG] nonebot | Running Matcher(type='message', module=plugins.ai_chat_plugin, lineno=372)
2026-02-22 23:11:20 [DEBUG] nonebot | 2026-02-22 23:11:20 [DEBUG] nonebot | Running handler Dependent(call=handle_clear_history)
2026-02-22 23:11:20 [INFO] nonebot | 2026-02-22 23:11:20 [INFO] nonebot | Matcher(type='message', module=plugins.ai_chat_plugin, lineno=372) running complete
2026-02-22 23:11:20 [DEBUG] nonebot | 2026-02-22 23:11:20 [DEBUG] nonebot | Checking for matchers in priority 11...
2026-02-22 23:11:20 [DEBUG] nonebot | 2026-02-22 23:11:20 [DEBUG] nonebot | Checking for matchers in priority 20...
2026-02-22 23:11:20 [INFO] nonebot | 2026-02-22 23:11:20 [INFO] nonebot | Event will be handled by Matcher(type='message', module=plugins.ai_chat_plugin, lineno=323)
2026-02-22 23:11:20 [DEBUG] nonebot | 2026-02-22 23:11:20 [DEBUG] nonebot | Running Matcher(type='message', module=plugins.ai_chat_plugin, lineno=323)
2026-02-22 23:11:20 [DEBUG] nonebot | 2026-02-22 23:11:20 [DEBUG] nonebot | Running handler Dependent(call=handle_ai_chat)
2026-02-22 23:11:20 [DEBUG] ai_chat_plugin | 2026-02-22 23:11:20 [DEBUG] ai_chat_plugin | 收到消息事件，AI_ENABLED=True
2026-02-22 23:11:20 [INFO] nonebot | 2026-02-22 23:11:20 [INFO] nonebot | Matcher(type='message', module=plugins.ai_chat_plugin, lineno=323) running complete
2026-02-22 23:11:20 [ERROR] nonebot | 2026-02-22 23:11:20 [ERROR] nonebot | Running Matcher(type='message', module=plugins.ai_chat_plugin, lineno=323) failed.
Traceback (most recent call last):

  File "F:\devbot\nonebot-plugin-mbtistats-devbot\bot.py", line 52, in <module>
    nonebot.run()
    │       └ <function run at 0x000002A27728D260>
    └ <module 'nonebot' from 'F:\\devbot\\nonebot-plugin-mbtistats-devbot\\.venv\\Lib\\site-packages\\nonebot\\__init__.py'>

  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\__init__.py", line 337, in run
    get_driver().run(*args, **kwargs)
    │                 │       └ {}
    │                 └ ()
    └ <function get_driver at 0x000002A2761F0EA0>
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\drivers\fastapi.py", line 187, in run
    uvicorn.run(
    │       └ <function run at 0x000002A27981E340>
    └ <module 'uvicorn' from 'F:\\devbot\\nonebot-plugin-mbtistats-devbot\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\uvicorn\main.py", line 593, in run
    server.run()
    │      └ <function Server.run at 0x000002A27981DBC0>
    └ <uvicorn.server.Server object at 0x000002A27AAFBCB0>
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio_run(self.serve(sockets=sockets), loop_factory=self.config.get_loop_factory())
           │           │    │             │                      │    │      └ <function Config.get_loop_factory at 0x000002A27981D440>
           │           │    │             │                      │    └ <uvicorn.config.Config object at 0x000002A279F1F4D0>
           │           │    │             │                      └ <uvicorn.server.Server object at 0x000002A27AAFBCB0>
           │           │    │             └ None
           │           │    └ <function Server.serve at 0x000002A27981DC60>
           │           └ <uvicorn.server.Server object at 0x000002A27AAFBCB0>
           └ <function run at 0x000002A275C16C00>
  File "C:\Users\minec\AppData\Roaming\uv\python\cpython-3.13.11-windows-x86_64-none\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002A27A5B91C0>
           │      └ <function Runner.run at 0x000002A275D09300>
           └ <asyncio.runners.Runner object at 0x000002A27AD18050>
  File "C:\Users\minec\AppData\Roaming\uv\python\cpython-3.13.11-windows-x86_64-none\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002A275D06E80>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000002A27AD18050>
  File "C:\Users\minec\AppData\Roaming\uv\python\cpython-3.13.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 712, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002A275D06DE0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\minec\AppData\Roaming\uv\python\cpython-3.13.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 683, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002A275D08C20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "C:\Users\minec\AppData\Roaming\uv\python\cpython-3.13.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 2050, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002A275C17BA0>
    └ <Handle Task.task_wakeup()>
  File "C:\Users\minec\AppData\Roaming\uv\python\cpython-3.13.11-windows-x86_64-none\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\utils.py", line 259, in run_coro_with_shield
    return await coro
                 └ <coroutine object check_and_run_matcher at 0x000002A27B05A200>
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\message.py", line 508, in check_and_run_matcher
    await _run_matcher(
          └ <function _run_matcher at 0x000002A2773CE980>
> File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\message.py", line 460, in _run_matcher
    await matcher.run(bot, event, state, stack, dependency_cache)
          │       │   │    │      │      │      └ {<function matcher_mutex at 0x000002A27A5AF420>: <nonebot.internal.params.DependencyCache object at 0x000002A27AFE7E30>, <fun...
          │       │   │    │      │      └ <contextlib.AsyncExitStack object at 0x000002A27AE4ED70>
          │       │   │    │      └ {'_prefix': {'command': None, 'raw_command': None, 'command_arg': None, 'command_start': None, 'command_whitespace': None}}
          │       │   │    └ PrivateMessageEvent(time=datetime.datetime(2026, 2, 22, 23, 11, 20, 632289), self_id='robot', post_type='message', user=User(...
          │       │   └ Bot(type='Console', self_id='robot')
          │       └ <function Matcher.run at 0x000002A2772C8E00>
          └ Matcher(type='message', module=plugins.ai_chat_plugin, lineno=323)
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\internal\matcher\matcher.py", line 926, in run
    await self.simple_run(bot, event, state, stack, dependency_cache)
          │    │          │    │      │      │      └ {<function matcher_mutex at 0x000002A27A5AF420>: <nonebot.internal.params.DependencyCache object at 0x000002A27AFE7E30>, <fun...
          │    │          │    │      │      └ <contextlib.AsyncExitStack object at 0x000002A27AE4ED70>
          │    │          │    │      └ {'_prefix': {'command': None, 'raw_command': None, 'command_arg': None, 'command_start': None, 'command_whitespace': None}}
          │    │          │    └ PrivateMessageEvent(time=datetime.datetime(2026, 2, 22, 23, 11, 20, 632289), self_id='robot', post_type='message', user=User(...
          │    │          └ Bot(type='Console', self_id='robot')
          │    └ <function Matcher.simple_run at 0x000002A2772C8D60>
          └ Matcher(type='message', module=plugins.ai_chat_plugin, lineno=323)
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\internal\matcher\matcher.py", line 863, in simple_run
    await handler(
          └ Dependent(call=handle_ai_chat)
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\dependencies\__init__.py", line 113, in __call__
    return await cast(Callable[..., Awaitable[R]], self.call)(**values)
                 │    │             │         │    │    │       └ {'bot': Bot(type='Console', self_id='robot'), 'event': PrivateMessageEvent(time=datetime.datetime(2026, 2, 22, 23, 11, 20, 63...
                 │    │             │         │    │    └ <function handle_ai_chat at 0x000002A27AD10220>
                 │    │             │         │    └ Dependent(call=handle_ai_chat)
                 │    │             │         └ ~R
                 │    │             └ <class 'collections.abc.Awaitable'>
                 │    └ typing.Callable
                 └ <function cast at 0x000002A275CEA3E0>

  File "F:\devbot\nonebot-plugin-mbtistats-devbot\plugins\ai_chat_plugin.py", line 334, in handle_ai_chat
    adapter_name = event.adapter.name
                   └ PrivateMessageEvent(time=datetime.datetime(2026, 2, 22, 23, 11, 20, 632289), self_id='robot', post_type='message', user=User(...

  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\pydantic\main.py", line 1026, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
                                 │                                          └ 'adapter'
                                 └ PrivateMessageEvent(time=datetime.datetime(2026, 2, 22, 23, 11, 20, 632289), self_id='robot', post_type='message', user=User(...

AttributeError: 'PrivateMessageEvent' object has no attribute 'adapter'


2026-02-22 23:11:20 [DEBUG] nonebot | 2026-02-22 23:11:20 [DEBUG] nonebot | Checking for matchers completed
2026-02-22 23:11:58 [SUCCESS] nonebot | 2026-02-22 23:11:58 [SUCCESS] nonebot | Console unmounted.
2026-02-22 23:11:58 [WARNING] nonebot | 2026-02-22 23:11:58 [WARNING] nonebot | Press Ctrl-C for Application exit
2026-02-22 23:11:59 [INFO] uvicorn | 2026-02-22 23:11:59 [INFO] uvicorn | Shutting down
2026-02-22 23:12:00 [INFO] uvicorn | 2026-02-22 23:12:00 [INFO] uvicorn | Waiting for application shutdown.
2026-02-22 23:12:00 [ERROR] uvicorn | 2026-02-22 23:12:00 [ERROR] uvicorn | Traceback (most recent call last):
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\starlette\routing.py", line 694, in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\minec\AppData\Roaming\uv\python\cpython-3.13.11-windows-x86_64-none\Lib\contextlib.py", line 221, in __aexit__
    await anext(self.gen)
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\drivers\fastapi.py", line 158, in _lifespan_manager
    await self._lifespan.shutdown()
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\internal\driver\_lifespan.py", line 81, in shutdown
    await self._run_lifespan_func(reversed(self._shutdown_funcs))
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\nonebot\internal\driver\_lifespan.py", line 55, in _run_lifespan_func
    await cast(ASYNC_LIFESPAN_FUNC, func)()
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\dev-plugins\mbtistats\src\nonebot_plugin_mbtistats\playwright_context.py", line 59, in close
    await cls._browser.close()
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\playwright\async_api\_generated.py", line 14264, in close
    return mapping.from_maybe_impl(await self._impl_obj.close(reason=reason))
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\playwright\_impl\_browser.py", line 241, in close
    raise e
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\playwright\_impl\_browser.py", line 238, in close
    await self._channel.send("close", None, {"reason": reason})
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 69, in send
    return await self._connection.wrap_api_call(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "F:\devbot\nonebot-plugin-mbtistats-devbot\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 559, in wrap_api_call
    raise rewrite_error(error, f"{parsed_st['apiName']}: {error}") from None
Exception: Browser.close: Connection closed while reading from the driver

2026-02-22 23:12:00 [ERROR] uvicorn | 2026-02-22 23:12:00 [ERROR] uvicorn | Application shutdown failed. Exiting.
2026-02-22 23:12:00 [INFO] uvicorn | 2026-02-22 23:12:00 [INFO] uvicorn | Finished server process [20552]
