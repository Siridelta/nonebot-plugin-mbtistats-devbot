<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>ECharts LTTB 降采样效果演示</title>
    <!-- 引入 ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
        .chart-box { 
            background: white; 
            padding: 15px; 
            margin-bottom: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .chart { width: 100%; height: 350px; }
        h3 { margin-top: 0; color: #333; }
        p { color: #666; font-size: 0.9em; }
        .desc { background: #e6f7ff; border: 1px solid #91d5ff; padding: 10px; border-radius: 4px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>ECharts LTTB (Largest-Triangle-Three-Buckets) 降采样演示</h1>
    
    <div class="desc">
        <strong>测试数据说明：</strong> 生成了 20,000 个连续的时间点数据（模拟高频波动）。<br>
        <strong>LTTB 原理：</strong> 它不像“平均值”那样简单平滑，而是尝试保留数据的“视觉形状”（特别是峰值和谷值）。
    </div>

    <!-- 图表 1：基准 -->
    <div class="chart-box">
        <h3>1. 原始数据 (无采样)</h3>
        <p>显示所有 20,000 个点。渲染压力大，且如果开启显示点 (Symbol)，会密集成一条粗线。</p>
        <div id="chart1" class="chart"></div>
    </div>

    <!-- 图表 2：LTTB + 显示点 -->
    <div class="chart-box">
        <h3>2. 开启 LTTB 采样 + 显示数据点 (Symbol: 'circle')</h3>
        <p>采样率设为自动或特定像素比。你会看到<strong>数据点变少了</strong>，只保留了关键的形状点。</p>
        <div id="chart2" class="chart"></div>
    </div>

    <!-- 图表 3：LTTB + 不显示点 -->
    <div class="chart-box">
        <h3>3. 开启 LTTB 采样 + 隐藏数据点 (Symbol: 'none')</h3>
        <p>这是最推荐的用法。看起来和原始数据形状几乎一样，但实际上点数大大减少，渲染极快。</p>
        <div id="chart3" class="chart"></div>
    </div>

    <script>
        // --- 1. 生成 20,000 条模拟数据 ---
        let baseTime = new Date(2023, 0, 1).getTime();
        let hour = 3600 * 1000;
        let data = [];
        let value = 100;

        for (let i = 0; i < 20000; i++) {
            // 模拟随机游走数据
            value = value + Math.random() * 10 - 5; 
            // 偶尔加个突变，测试 LTTB 对极值的保留
            if (i % 1000 === 0) value += 50; 
            if (i % 1000 === 500) value -= 50;

            // 限制一下范围防止飞出天际
            if (value < 0) value = 10;
            
            data.push([baseTime + i * hour, value]);
        }

        // --- 2. 配置通用选项 ---
        const commonOption = {
            tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'cross' }
            },
            grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true },
            xAxis: {
                type: 'time',
                boundaryGap: false
            },
            yAxis: {
                type: 'value',
                boundaryGap: [0, '100%']
            },
            dataZoom: [
                { type: 'inside', start: 0, end: 100 },
                { start: 0, end: 100 }
            ]
        };

        // --- 图表 1：原始数据 ---
        const chart1 = echarts.init(document.getElementById('chart1'));
        chart1.setOption({
            ...commonOption,
            title: { text: 'Total: 20,000 points' },
            series: [{
                name: '模拟数据',
                type: 'line',
                data: data,
                symbol: 'none', // 原始数据如果不隐藏点，2万个圆圈会卡死浏览器或变成一团黑
                sampling: null  // 关闭采样
            }]
        });

        // --- 图表 2：LTTB + 显示点 ---
        const chart2 = echarts.init(document.getElementById('chart2'));
        chart2.setOption({
            ...commonOption,
            title: { text: 'LTTB Sampling (Points Visible)' },
            series: [{
                name: '模拟数据',
                type: 'line',
                data: data,
                symbol: 'emptyCircle',
                symbolSize: 6,     // 点的大小
                sampling: 'lttb',  // 开启 LTTB 算法
                smooth: true,
                // itemStyle: { color: '#ff7070' }
            }]
        });

        // --- 图表 3：LTTB + 隐藏点 ---
        const chart3 = echarts.init(document.getElementById('chart3'));
        chart3.setOption({
            ...commonOption,
            title: { text: 'LTTB Sampling (Line Only)' },
            series: [{
                name: '模拟数据',
                type: 'line',
                data: data,
                symbol: 'none',    // 隐藏点
                sampling: 'lttb',  // 开启 LTTB 算法
                itemStyle: { color: '#5470c6' }
            }]
        });

        // 响应窗口大小变化
        window.addEventListener('resize', () => {
            chart1.resize();
            chart2.resize();
            chart3.resize();
        });
    </script>
</body>
</html>